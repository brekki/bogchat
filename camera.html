<!DOCTYPE html>
 
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>imgur oauth</title><link href="style.css">
<link rel="stylesheet" style="text/css" href="style.css">
   
   </head>
      <body>
     <div id="camerabutton"></div>
     <div id="videobox" class="hidden">
     <div id="videoclose"></div>
       <video id="video" width="400" height="300" autoplay></video></div>

<canvas id="canvas" width="400" height="300" style="display:none"></canvas>


  </body>
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <script src="jcanvas.js"></script>
   <script>
   

var videoopen = false
var video = document.getElementById('video');
var localstream
// Get access to the camera!
function cameraopen(){
  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      // Not adding `{ audio: true }` since we only want video now
      navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
        video.src = window.URL.createObjectURL(stream)
        localstream = stream
        video.play()
      })
  }

  else if (navigator.getUserMedia) { 
      navigator.getUserMedia({ video: true }, function(stream) {
          video.src = stream;
          localstream = stream
          video.play();
      }, errBack);
  } 
  else if (navigator.webkitGetUserMedia) { 
      navigator.webkitGetUserMedia({ video: true }, function(stream){
          video.src = window.webkitURL.createObjectURL(stream);
          localstream = stream
          video.play();
      }, errBack);
  } 
  else if(navigator.mozGetUserMedia) { 
      navigator.mozGetUserMedia({ video: true }, function(stream){
          video.src = window.URL.createObjectURL(stream);
          localstream = stream
          video.play();
      }, errBack);
  }
}

// Elements for taking the snapshot
var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');
var video = document.getElementById('video');
    
function webcamtoimgur(uri) {
var clientId = "a91768c3de50774";               
$.ajax({
url: "https://api.imgur.com/3/upload",
type: "POST",
datatype: "json",
data: {
'image': uri,
'type': 'base64'
},
success: fdone,//calling function which displays url
error: function(){console.log("failed")},
beforeSend: function (xhr) {
xhr.setRequestHeader("Authorization", "Client-ID " + clientId);
}
})
}

   $('#videoclose').click(function() {
     localstream.getVideoTracks()[0].stop()
     videoopen = false
     $('#videobox').addClass('hidden')
     $('#camerabutton').removeClass('howto')
   })
   
   $('#camerabutton').click(function() {
   if (!videoopen) {
      $('#camerabutton').addClass('howto')
      $('#videobox').removeClass('hidden')
      videoopen = true
     cameraopen()
      $('#camerabutton').prop("disabled", true)
      setTimeout(function(){
      $('#camerabutton').prop("disabled", false);
      },1200);
     }
     else {
     	context.drawImage(video, 0, 0, 400, 300)
      var image = $('#canvas').getCanvasImage()
      var uri = image.substring(22)
      webcamtoimgur(uri)
      $('#camerabutton').prop("disabled", true)
      setTimeout(function(){
      $('#camerabutton').prop("disabled", false);
      },3000);
     }
   })
    
function fdone(data) {
  console.log(data.data.link);     
}
 

</html>